package code

import (
	"bytes"
	"encoding/gob"
	"github.com/shopspring/decimal"
	"strings"
)

var (


	creator = "su6e7c6935ce786d30237893d086b6d9c44aa01666"
	logo = "FFD8FFE000104A46494600010100000100010000FFE202284943435F50524F46494C450001010000021800000000021000006D6E74725247422058595A2000000000000000000000000061637370000000000000000000000000000000000000000000000000000000010000F6D6000100000000D32D0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000964657363000000F0000000747258595A00000164000000146758595A00000178000000146258595A0000018C0000001472545243000001A00000002867545243000001A00000002862545243000001A00000002877747074000001C80000001463707274000001DC0000003C6D6C756300000000000000010000000C656E5553000000580000001C0073005200470042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000058595A200000000000006FA2000038F50000039058595A2000000000000062990000B785000018DA58595A2000000000000024A000000F840000B6CF706172610000000000040000000266660000F2A700000D59000013D000000A5B000000000000000058595A20000000000000F6D6000100000000D32D6D6C756300000000000000010000000C656E5553000000200000001C0047006F006F0067006C006500200049006E0063002E00200032003000310036FFDB00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFDB00430101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFC0001108003C003C03012200021101031101FFC4001C0001000202030100000000000000000000000109070802030A05FFC4003110000005030302040406030000000000000102040506030711000821123109144151131516221724326171913381F0FFC4001C0101000105010100000000000000000000000601030405070208FFC4002C1100010303040103040105000000000000010204110305060012213107131441152251712434618191A1FFDA000C03010002110311003F00F7F1A6A04C50EE600FE44353A6A92262448EC7CE9A6A3219C64321DC33C867B71FBE990C67218F7CF1FDE9A48FC8F9FF009DFF00A913FBD4E9A8C87B87F7A088006444003DC4431A69204C9023BE7AFDEA74D40080F6101FE073A9D3491F91AA9BDD6CFB712E7BA88158EB297169433EA5B7D51ED1A55299BCED959DD1D69DBBA958A947C99CDCBF389630950894E3E47A483F0887115E53E55DA66ED1D272EEB2C2DF8466876E1A1C6AA8152670A6911D19E274494AAAB3BB6264A62B791E08843CFAF44DB86C746D134AE2453472A38374731EDD121CDE269618D40BF7FE17BA0107D8C2D37944400447D07D7DB9D600B989E8DDFBECE566EF72EAB652FA46A7EB9D36EF7CD136169279043554AD73BC3A24FE442B5BD22F588D20D3FA1DF123A371C24E90CDC3F2E97A0766B9D6AA8545A6BB9A86B8FEBD2C85350F8F4692A62202F728ED3202940A4C95275F132B25C8F1DCEB2EC9D9E4371715C7931D624AC7AFAF16314BCDB8D93197AD2D2C9DBA1ED2C97905EBB55A5DCA5ABC5EE66E7EE5275BA10BBC4F6E9BEABCB69ABDC6952E628CDB640EC96DB2B80C3D144D89515BEDAAD07B6C9FA392AB97BBB81C650A8E66E708CA06A133AAFA40E06FA75ACCE0F0FCBC2F379ED0CA242F972A597494B75CC7B63A4F130B7B10B6EE6813830C59DC1952B243A492140B50A2339A95A0E15DC69B90D454B9B08DA56E6D6C0A981ED8900BE2A1B8D30982B07E0C2120571C07574C7EC5875702219FB443003CF3CEBB7C1E8A34B6F770A98104C21799F4C1CF48880C32025C0098043D739C6B76850A89200020541224494554A01851312146640238DB038331C2F2FBB3EF21582DD5AA90D5DE51E6B655121F3D5909B15EACE96420BB5B554256AE3616EDE3F8A1B85106D7D410E74E6201C6894C511EB2094428603026C18404C5E7A843218E910E7D29864D2A953AB7459336F8C7598665CC6C8B1048172688D861FAA9D5549640EC12132634F4B4DBBE131AB628F95B291EB36F4C645E003E2BBB951D5CFAEEAF24B07A073E5150FEA0CFF8CDC67B0F71C08761FE435E747661B45DB7DC5D9A4CAF75C3B1CED776E2C606E42D6F6066995CA6672969A2886A3AB4C4DA90C31E4A9017392D016D6A321607470319510B4E9BA5513054CE63529200A950130A1091B7B514854EE0AEE5324900004F04CEA49E61AB77777FC671BB43666AAF74B1E51717CF1EE5192D80219594D9CA9284E36955476E545DC8068129020281AC454C9F72267BF8DB2C263DB9E816E9A1DBD8DBF342A32D9F3637C361ACE9D5300AB571F5AE4D6EB0FA7247056CAC2B004EEEFEC933008B3A24176788A39C59B65052DCDDB29FA2BB56E2077423A956A363B850F8ECCDA913B01523A226F92B525794691C933755754545C53A5594692FA699C15D122C2D72D2AF569812A1E855F2E3EE92EED9064D8E6DD762570B6CB10985518C394AE6CE170ABC6A370A7773572299A5592892C323DF2F2BFF009C58779727071933ABA35AB7A8AB5461C256FCDC0DB7C1622D9D1B3366AD8DA8A4E09DD42DE41E3310A8F141B859E9BDA9606848DAB5EC1ABCDB8FCBC5E56A750E46482E4E26A46542075CA8FD558D90FC534B7A45484077BFEC090254D206D2A1B7B2A0074206DE8F1AB7E2272ED57FBAD2B43CBFBBC49163B77BD4E41F5A74C99659EA43B69627B93A29DD5DB3F6C02EAA95F622A6C5C05575246BA4F6DD2A5BBCEB39712941268B4A921AF8D55E6E89ED869C15829216F999411B8330C7973F297B70A9292251F89208FB7D522A6EACD247216392D12649DCCEDB20FB9083578EC8A891B640DA552AE212E4C94B55DA38E55803AC4082620AE67713254A57465A950B49C489E9D529D03AB7B639B7ECE07400E0D81E8C0FE8C600C23810E4479CE78EFEBE9AE0620808097B64C3D222223CF00002239FD40223C76E0751F1429C56A7C00E393020286D44498926024C9248E21501207493E3CB13963985AAE941374B6E637055C1FB376CD9A7D3A8E593165285344B626A20B24B94BC51F7895800578A1442696366369EFEC5777770DDEF547A54E0E29ED22C8C56B82E089C94C7A4AA5BD75B86F603B7CD0E9A92091A95D1B654F532B8C3290142B864FD6F20E1AC37B57BBBB90DA1432556E0FB32BB73FACE53C7190A9744CDF306BA141456688FB0A9A08C50C0640DCF0944588CBC8E4DEE22DAE02AC4D4CC5308EBD069000DF7814A03EB8F70C867AB1FB644473C863D75C3E1532E0A5A4023C88864A03DF239E3EEEFE99000F7E754A344D046CA759702472A4A890A585A82CAC19320190249E4A8EB99B1F01A6C4DAC031ACEB21B45C31FB8652F69DED4D2CF787EF8655559D47B4DF7D4593B0E882D1212E480B2793D6B4C76D5B8CBAD7EEACDD1DC2DB64D6C4A5606F6C16C572B552039648A9E0AB4AA92370BDC3622222DC28C3ACC80CE21D0B120D40422214C7E3F879C0C201B688FB505BEB8B6C552C914BDC55C46E939373A4B50D7F9FAD4615CEA124661C5F24B9321A2B5B817471BAA011566999C5A85B9CDC37ABA00BD3D00000391128060071E98C7219C8E07BF1EBCE825EE18C09B039EAE4003D3911FFBFD6330D41E91A4206E8330990130261204753C40312654011D3ED388396AFAC576BDDF9EE4579B130BCB01707CC2CED16F537A74C9DCC3164D835F6A96686C10D4212E1265CEF2028730A54C07214CA03EE01CF3DF90D7669A6AC1E7BE7F7A9DA5200809091D9000027FC7CF1DFF006D301DF1CFBE9A69A6BD69A60339C067DFD74D34D34C07B071DBF6D34D34D34D34D34D35FFD9"
	total = 120000000
	precision = "10"
	mineral = 33.9
	name= "nlp"
	gross = "120000000"
	email = "296229236@qq.com"
	site = ""
	rate = "0"
)



/**
publish token
*/
func publish(stub StubInterface, originatorAccount, name,gross,output,site,logo,email,rate,precision string) {
	stub.UpdateAccountBalance(stub, name, originatorAccount, output, precision)
	config := []string{
		originatorAccount,
		name,
		gross,
		output,
		precision,
		site,
		logo,
		email,
		rate,
	}

	var network bytes.Buffer
	enc := gob.NewEncoder(&network)
	enc.Encode(config)
	stub.PutState(name, network.Bytes())
}

/**
Transfer function
 */
func transfer(stub StubInterface, outAccount,inAccount,amount,minerFee,token string)pb.Response {
	var err error
	minerFeeVal, err := decimal.NewDecimalFromString(minerFee)
	if err != nil {
		return shim.Error("Miner fee format error")
	}
	outVal, err := decimal.NewDecimalFromString(amount)
	if err != nil {
		return shim.Error("Transaction quantity format error")
	}
	if outVal.LessThan(decimal.NewFromFloat(0)) {
		return shim.Error("The number of transactions must be greater than 0")
	}
	minerFeeRate, _ := decimal.NewDecimalFromString("0.004")
	rightMinerFee := self.chargeLowLimit
	calFee := outVal.Mul(minerFeeRate).Round(6)
	if calFee.GreaterThan(rightMinerFee) {
		if !calFee.Equal(minerFeeVal) {
			return shim.Error("transfer fee is not right")
		}
		rightMinerFee = calFee
	} else {
		if !minerFeeVal.Equal(rightMinerFee) {
			return shim.Error("transfer fee is not right")
		}
	}
	_, err = stub.updateAccount(outAccount, inAccount, token, outVal, minerFeeVal)
	if err != nil {
		return shim.Error(err.Error())
	}
	return shim.Success([]byte("success"))
}

/**
Query account balance
 */
func balance(stub StubInterface,token,account string)pb.Response{
	if token == "" || account == "" {
		return shim.Error("Parameters cannot be empty")
	}
	token = strings.ToLower(token)
	account = strings.ToLower(account)
	accountVal,err := stub.getBalance(token,account)
	if err != nil {
		return shim.Error(err.Error())
	}
	return shim.Success([]byte(accountVal.String()))
}
